<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Agendamento - Barbearia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }
    h1 { text-align: center; }
    label { margin-top: 10px; display: block; }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: none;
    }
    input, select { background: #333; color: #fff; }
    button {
      background: #c89b3c;
      color: #000;
      font-weight: bold;
      margin-top: 15px;
      cursor: pointer;
    }
    #msg { margin-top: 10px; text-align: center; }
    .ocupado { color: #ff5252; font-size: 14px; }
    .admin {
      margin-top: 15px;
      background: #444;
      color: #fff;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Agendamento</h1>

  <form id="form">
    <label>Nome</label>
    <input id="nome" required>

    <label>WhatsApp</label>
    <input id="telefone" required>

    <label>Servi√ßo</label>
    <select id="servico">
      <option>Corte</option>
      <option>Barba</option>
      <option>Corte + Barba</option>
    </select>

    <label>Data</label>
    <input type="date" id="data" required>

    <label>Hor√°rio</label>
    <select id="hora"></select>

    <button type="submit">Agendar</button>
  </form>

  <div id="msg"></div>
  <div id="ocupados" class="ocupado"></div>

  <button class="admin" onclick="limparAgenda()">Limpar agenda (admin)</button>
</div>

<script>
  const inicio = 9;
  const fim = 18;
  const intervalo = 30;
  const horaSelect = document.getElementById("hora");

  function gerarHorarios() {
    horaSelect.innerHTML = "";
    for (let h = inicio; h < fim; h++) {
      for (let m = 0; m < 60; m += intervalo) {
        const hh = String(h).padStart(2, "0");
        const mm = String(m).padStart(2, "0");
        horaSelect.innerHTML += `<option>${hh}:${mm}</option>`;
      }
    }
  }
  gerarHorarios();

  function getAgendamentos() {
    return JSON.parse(localStorage.getItem("agendamentos")) || [];
  }

  function salvarAgendamentos(a) {
    localStorage.setItem("agendamentos", JSON.stringify(a));
  }

  function mostrarOcupados(data) {
    const lista = getAgendamentos().filter(a => a.data === data);
    document.getElementById("ocupados").innerText =
      lista.length ? "Hor√°rios ocupados: " + lista.map(a => a.hora).join(", ") : "";
  }

  document.getElementById("data").addEventListener("change", e => {
    mostrarOcupados(e.target.value);
  });

  document.getElementById("form").addEventListener("submit", e => {
    e.preventDefault();
    const nome = nome.value;
    const telefone = telefone.value;
    const servico = servico.value;
    const data = dataInput.value = document.getElementById("data").value;
    const hora = horaSelect.value;

    const agendamentos = getAgendamentos();
    if (agendamentos.find(a => a.data === data && a.hora === hora)) {
      msg.innerText = "‚ùå Hor√°rio j√° ocupado";
      return;
    }

    agendamentos.push({ nome, telefone, servico, data, hora });
    salvarAgendamentos(agendamentos);

    const texto =
      `Ol√°! üëã%0A` +
      `Seu hor√°rio foi *pr√©-agendado*.%0A%0A` +
      `üë§ Nome: ${nome}%0A` +
      `‚úÇÔ∏è Servi√ßo: ${servico}%0A` +
      `üìÖ Data: ${data}%0A` +
      `‚è∞ Hor√°rio: ${hora}%0A%0A` +
      `Aguarde a confirma√ß√£o da barbearia.`;

    window.open(`https://wa.me/55921304223?text=${texto}`, "_blank");

    msg.innerText = "‚úÖ Hor√°rio reservado!";
    mostrarOcupados(data);
    form.reset();
  });

  function limparAgenda() {
    if (confirm("Deseja limpar toda a agenda?")) {
      localStorage.removeItem("agendamentos");
      document.getElementById("ocupados").innerText = "";
      alert("Agenda limpa!");
    }
  }
</script>
</body>
</html>
